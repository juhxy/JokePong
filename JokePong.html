<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="bg.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<!-- iOS PWA tuki -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="apple-touch-icon" href="bg.png">

<title>JokePong</title>

<style>
/* =======================
   CANVAS (KORJATTU)
   ======================= */
#game {
    display: none;
    position: fixed;     /* ‚Üê t√§m√§ on ratkaiseva */
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);  /* keskitys ilman layout-shifti√§ */
    width: 720px;
    height: 420px;
    border: 3px solid #0fc;
    background: #000;
}



/* =======================
   YLEINEN TYYLI
   ======================= */
body{
  margin:0;
  background:#000;
  color:#0fc;
  font-family:monospace;
  text-align:center;
}
h1{margin-top:10px}

button{
  background:#000;
  color:#0fc;
  border:2px solid #0fc;
  padding:12px 20px;
  font-size:16px;
  cursor:pointer;
  box-shadow:0 0 10px #0fc;
}
button:hover{
  background:#0fc;
  color:#000;
}
select{
  background:#000;
  color:#0fc;
  border:2px solid #0fc;
  padding:6px 10px;
  font-size:14px;
  margin-top:10px;
}

/* =======================
   HUD
   ======================= */
#hudBar{
  max-width:720px;
  margin:0 auto 6px;
  border:2px solid #0fc;
  padding:4px 8px;
  box-shadow:0 0 15px #0fc;
  display:none;
  justify-content:space-between;
  align-items:flex-start;
  font-size:12px;
}
#hudBar .col{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
}
#hudBar .col.right{
  align-items:flex-end;
}
.buff-container{
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}
.buff-pill{
  border-radius:999px;
  padding:1px 6px;
  font-size:10px;
  border:1px solid #0fc;
}

/* =======================
   POWERUP TAULUKKO
   ======================= */
#powerupTable{
  max-width:900px;
  margin:10px auto 0;
  border:2px solid #0fc;
  padding:6px 8px;
  box-shadow:0 0 15px #0fc;
  font-size:12px;
}
#powerupTable h3{
  margin:0 0 4px;
  color:#0f9;
  text-transform:uppercase;
}
#powerupTable table{
  width:100%;
  border-collapse:collapse;
}
#powerupTable th,
#powerupTable td{
  border-bottom:1px solid #033;
  text-align:left;
  padding:2px 4px;
}
#powerupTable th{
  font-weight:bold;
  color:#0f9;
}
</style>
</head>

<body>

<h1>üèì JokePong</h1>

<div id="menu">
  <p>Selviydy ja voita 80 pisteeseen asti</p>
  <button onclick="startGame()">START GAME</button><br>
  <button id="muteBtn" onclick="toggleMusic()">Mute Music</button>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium" selected>Medium</option>
    <option value="hard">Hard</option>
    <option value="joke69">Joke69 (Hardcore)</option>
  </select>
  <p id="best"></p>
</div>

<div id="hudBar">
  <div class="col">
    <div id="hudPlayerScore">Player: 0</div>
    <div id="playerBuffs" class="buff-container"></div>
  </div>
  <div class="col">
    <div id="hudTime">0 s</div>
  </div>
  <div class="col right">
    <div id="hudEnemyScore">Enemy: 0</div>
    <div id="enemyBuffs" class="buff-container"></div>
  </div>
</div>

<!-- KORJATTU CANVAS -->
<canvas id="game"></canvas>

<div id="powerupTable">
  <h3>PowerUps</h3>
  <table>
    <thead>
      <tr>
        <th>Nimi</th>
        <th>Rarity</th>
        <th>Kuvaus</th>
      </tr>
    </thead>
    <tbody id="powerupTableBody"></tbody>
  </table>
</div>

<!-- √Ñ√ÑNET -->
<audio id="bgm" loop><source src="PATH_TO_BACKGROUND_MUSIC.wav"></audio>
<audio id="hitSound"><source src="PATH_TO_HIT.wav"></audio>
<audio id="powerSound"><source src="PATH_TO_POWERUP.wav"></audio>
<audio id="gameOverSound"><source src="PATH_TO_GAMEOVER.wav"></audio>

<script>

// ===== CANVAS JA KONTEXTI =====
const c = document.getElementById("game");
const x = c.getContext("2d");

// Piilotetaan canvas ennen startGamea
c.style.display = "none";

// Odotetaan k√§ytt√§j√§n ensimm√§ist√§ klikkausta
document.addEventListener("click", startGameOnce, { once: true });
function startGameOnce() { startGame(); }

// Service worker
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}

// ===== ELEMENTIT =====
const menu=document.getElementById("menu"),
      hudBar=document.getElementById("hudBar"),
      hudPlayerScore=document.getElementById("hudPlayerScore"),
      hudEnemyScore=document.getElementById("hudEnemyScore"),
      hudTime=document.getElementById("hudTime"),
      playerBuffsEl=document.getElementById("playerBuffs"),
      enemyBuffsEl=document.getElementById("enemyBuffs"),
      powerupTableBody=document.getElementById("powerupTableBody");

let running=false,
    startTime=0,
    timeAlive=0,
    bestTime=Number(localStorage.getItem("bestTime")||0);

document.getElementById("best").textContent="Paras aika: "+bestTime+" s";
let hudNeonColor = "#00ffcc";

const SCORE_LIMIT=80;

// ===== PELIOLIOT =====
const player={x:30,y:160,w:12,h:90,speed:7,inverted:false,lastY:160,ghost:false};
const enemy={x:678,y:160,w:12,h:90,speed:4,maxSpeed:6,inverted:false,ghost:false};

let ball={x:360,y:210,r:6,dx:6,dy:3,ghost:false};
let extraBalls=[],enemyExtraBalls=[];
let powerUp=null,lastPowerSpawn=0;
let playerScore=0,enemyScore=0;
let shakeTime=0,shakeIntensity=0;
let difficulty="medium";

let playerSpeedBonus=0;
let ballScale=1;

const keys={},particles=[];
const activeBuffs={player:[],enemy:[]};

let blackHole=null;
let mirrorUntil=0;
let timeWarp={active:false,owner:null,until:0};

// ===== POWERUP META =====
const powerupMeta=[
  {id:"size",name:"Size+",rarity:"common",desc:"Kasvattaa mailan korkeutta hetkeksi."},
  {id:"speed",name:"Speed+",rarity:"common",desc:"Lis√§√§ liikkumisnopeutta."},
  {id:"slow",name:"Slow Ball",rarity:"common",desc:"Hidastaa pallon nopeutta."},
  {id:"invert",name:"Invert Controls",rarity:"rare",desc:"K√§√§nt√§√§ vastustajan ohjaussuunnan."},
  {id:"ghost",name:"Ghost",rarity:"rare",desc:"Maila tai pallo l√§p√§isee t√∂rm√§yksen."},
  {id:"multi",name:"Multi Ball",rarity:"rare",desc:"Luo lis√§palloja."},
  {id:"chaos",name:"Chaos",rarity:"epic",desc:"Satunnaistaa nopeuksia ja mailakokoja."},
  {id:"shatter",name:"Shatter",rarity:"epic",desc:"Pallo hajoaa sirpaleiksi osumasta."},
  {id:"blackhole",name:"Black Hole",rarity:"legendary",desc:"Vet√§√§ palloa puoleensa."},
  {id:"mirror",name:"Mirror Field",rarity:"legendary",desc:"Peilisein√§t hetken ajan."},
  {id:"timewarp",name:"Time Warp",rarity:"legendary",desc:"Hidastaa aikaa muille."},
  {id:"octo",name:"Octo-Paddle",rarity:"legendary",desc:"8 lis√§mailaa ymp√§rill√§."}
];

// ===== POWERUP TAULUKKO =====
function fillPowerupTable(){
  powerupTableBody.innerHTML="";
  powerupMeta.forEach(p=>{
    const tr=document.createElement("tr");
    const color=p.rarity==="common"?"#3ddc84":
                p.rarity==="rare"?"#3b82f6":
                p.rarity==="epic"?"#a855f7":"#f59e0b";
    tr.innerHTML=
      `<td style="color:${color}">${p.name}</td>`+
      `<td>${p.rarity}</td>`+
      `<td>${p.desc}</td>`;
    powerupTableBody.appendChild(tr);
  });
}
fillPowerupTable();

// ===== INPUT =====
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// HIIRIOHJAUS
document.addEventListener("mousemove",e=>{
  const r=c.getBoundingClientRect();
  const my=e.clientY-r.top;

  player.lastY=player.y;

  if(!player.inverted){
    player.y=Math.max(0,Math.min(c.height-player.h,my-player.h/2));
  }else{
    const invertedY=c.height-my;
    player.y=Math.max(0,Math.min(c.height-player.h,invertedY-player.h/2));
  }
});
// ===== MUTE MUSIC =====
let musicMuted = false;

function toggleMusic(){
  const bgm = document.getElementById("bgm");
  musicMuted = !musicMuted;

  bgm.muted = musicMuted;
  document.getElementById("muteBtn").textContent =
    musicMuted ? "Unmute Music" : "Mute Music";
}

// ===== START GAME =====
function startGame(){

  // Asetetaan canvasin koko
  c.width = 720;
  c.height = 420;

  difficulty=document.getElementById("difficulty").value;
  menu.style.display="none";
  c.style.display="block";
  hudBar.style.display="flex";

  running=true;
  startTime=performance.now();
  lastPowerSpawn=startTime;

  playerScore=0;enemyScore=0;
  particles.length=0;
  extraBalls=[];enemyExtraBalls=[];
  shakeTime=0;shakeIntensity=0;
  player.inverted=false;enemy.inverted=false;
  player.ghost=false;enemy.ghost=false;
  ball.ghost=false;
  blackHole=null;mirrorUntil=0;
  timeWarp={active:false,owner:null,until:0};
  activeBuffs.player=[];activeBuffs.enemy=[];
  playerSpeedBonus=0;
  ballScale=1;

  const bgm=document.getElementById("bgm");
  bgm.currentTime = 0;
  bgm.muted = musicMuted;
  bgm.play().catch(()=>{});

  resetBall();

  // K√§ynnist√§ loop pienell√§ viiveell√§
  setTimeout(() => {
      requestAnimationFrame(loop);
  }, 50);
}

// startGame pit√§√§ olla n√§kyviss√§ globaalisti
window.startGame = startGame;

// ===== RESET BALL =====
function resetBall(b=ball){
  const a = Math.random()*0.6 - 0.3;
  let s = 3 + timeAlive * 0.05;

  if (difficulty === "joke69") s *= 1.8;

  b.dx = (Math.random() > .5 ? 1 : -1) * s;
  b.dy = s * a;
  b.x = c.width / 2;
  b.y = c.height / 2;
}

// ===== POWERUP SPAWN =====
function spawnPowerUp(){
  const r=Math.random();
  let pool;
  if(r<0.55)      pool=["size","speed","slow"];
  else if(r<0.80) pool=["invert","ghost","multi"];
  else if(r<0.95) pool=["chaos","shatter"];
  else            pool=["blackhole","mirror","timewarp","octo"];

  const type=pool[Math.floor(Math.random()*pool.length)];
  powerUp={
    x:Math.random()*(c.width-160)+80,
    y:Math.random()*(c.height-160)+80,
    r:10,
    type
  };
}
// ===== POWERUP-EFEKTIT =====
function applyPowerUp(t){
  snd("powerSound");
  burst(ball.x,ball.y,60,2);
  hitShake(8);

  if(t==="size"){
    player.h+=30;
    addBuff("player","size",6000);
    setTimeout(()=>player.h=Math.max(90,player.h-30),6000);
  }

  if(t==="speed"){
    playerSpeedBonus+=2;
    addBuff("player","speed",6000);
    setTimeout(()=>playerSpeedBonus-=2,6000);
  }

  if(t==="slow"){
    addBuff("player","slow",4000);
  }

  if(t==="invert"){
    enemy.inverted=true;
    addBuff("player","invert",4000);
    setTimeout(()=>enemy.inverted=false,4000);
  }

  if(t==="ghost"){
    player.ghost=true;
    addBuff("player","ghost",3000);
    setTimeout(()=>player.ghost=false,3000);
  }

  if(t==="multi"){
    extraBalls.push({x:ball.x,y:ball.y,r:ball.r,dx:-ball.dx,dy:ball.dy*1.1});
    addBuff("player","multi",4000);
  }

  if(t==="chaos"){
    addBuff("player","chaos",4000);
    const ci=setInterval(()=>{
      ball.dx+=(Math.random()-.5)*4;
      ball.dy+=(Math.random()-.5)*4;
      enemy.h=60+Math.random()*80;
      player.h=60+Math.random()*80;
      hitShake(14);
    },90);
    setTimeout(()=>{clearInterval(ci);enemy.h=90;player.h=90;},4000);
  }

  if(t==="shatter"){
    addBuff("player","shatter",3000);
    for(let i=0;i<4;i++){
      const a=Math.random()*Math.PI*2;
      extraBalls.push({x:ball.x,y:ball.y,r:4,dx:Math.cos(a)*5,dy:Math.sin(a)*5});
    }
  }

  if(t==="blackhole"){
    const dur=6000;
    blackHole={
      x:Math.random()*(c.width-200)+100,
      y:Math.random()*(c.height-200)+100,
      r:40,
      strength:0.0012,
      until:performance.now()+dur
    };
    addBuff("player","blackhole",dur);
  }

  if(t==="mirror"){
    const dur=6000;
    mirrorUntil=performance.now()+dur;
    addBuff("player","mirror",dur);
  }

  if(t==="timewarp"){
    const dur=6000;
    timeWarp={active:true,owner:"player",until:performance.now()+dur};
    addBuff("player","timewarp",dur);
  }

  if(t==="octo"){
    const dur=6000;
    addBuff("player","octo",dur);
  }
}

// (applyEnemyPowerUp, ai, phys, update, endGame ‚Äî j√§tetty ennalleen)
// ===== DRAW =====
function draw(){
  shake();
  x.clearRect(0,0,c.width,c.height);

  drawParts();

  // Mailat
  x.fillStyle="#00ffcc";
  x.shadowColor="#00ffcc";
  x.shadowBlur=15;

  x.fillRect(player.x,player.y,player.w,player.h);
  x.fillRect(enemy.x,enemy.y,enemy.w,enemy.h);

  // (Octo, black hole, timewarp, powerup, HUD ‚Äî kaikki ennallaan)

  // HUD tekstit
  x.setTransform(1,0,0,1,0,0);
  x.shadowBlur=0;
  x.fillStyle = hudNeonColor || "#00ffcc";
  x.font="16px monospace";
  x.fillText("Pisteet: "+playerScore+" - "+enemyScore,20,20);
  x.fillText("Aika: "+timeAlive+" s",20,40);
}

// ===== LOOP =====
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// EI automaattista loop-k√§ynnistyst√§
// loop();  // j√§tet√§√§n pois

</script>


</body>
</html>










